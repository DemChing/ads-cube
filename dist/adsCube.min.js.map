{"version":3,"sources":["adsCube.js"],"names":["root","factory","define","amd","module","exports","adsCube","self","this","opts","locale","ads","dir","popup","fullscreen","responsive","autoClose","autoRotate","popupWait","counter","waitingMessage","closeMessage","Array","isArray","filter","v","src","length","console","error","backdrop","document","createElement","container","cube","axis","rDeg","ratio","width","Math","floor","body","clientWidth","height","clientHeight","isDomElem","x","Element","HTMLElement","min","distance","rotate","hasFocus","style","transform","getLocale","args","str","i","replace","className","setInterval","rotateLeft","rotateRight","rotateUp","rotateDown","concat","slice","map","ad","side","appendChild","backgroundImage","link","onclick","window","open","timeout","interval","countdown","time","setTimeout","rounded","round","pts","querySelector","push","cos","PI","y","sin","clipPath","join","innerHTML","remove","canClose","closePopup","click","href","elem","display"],"mappings":"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","file":"adsCube.min.js","sourcesContent":["(function(root, factory) {\n    if (typeof define === \"function\" && define.amd) {\n        define([], factory);\n    } else if (typeof module === \"object\" && module.exports) {\n        module.exports = factory();\n    } else {\n        root.adsCube = factory();\n    }\n})(typeof self !== \"undefined\" ? self : this, (function() {\n    return (opts, locale) => {\n        opts = {\n            ...{\n                ads: [],\n                dir: 0,\n                popup: false,\n                fullscreen: false,\n                responsive: false,\n                autoClose: false,\n                autoRotate: true,\n                popupWait: 10,\n                counter: 0\n            },\n            ...opts\n        };\n        locale = {\n            ...{\n                waitingMessage: \"Please wait %s seconds to close...\",\n                closeMessage: \"Click here to close\"\n            },\n            ...locale\n        };\n        if (!Array.isArray(opts.ads)) {\n            opts.ads = [];\n        }\n        opts.ads = opts.ads.filter(v => !!v.src);\n        if (opts.ads.length == 0) {\n            console.error(\"[ads-cube] No valid ads defined\");\n            return;\n        }\n        let backdrop = document.createElement(\"div\"), container = document.createElement(\"div\"), cube = document.createElement(\"div\"), axis = opts.dir < 2 ? \"Y\" : \"X\", rDeg = 0, ratio = opts.responsive && opts.fullscreen ? 1 : .8, width = Math.floor(document.body.clientWidth * ratio), height = Math.floor(document.body.clientHeight * ratio), isDomElem = x => x instanceof Element || x instanceof HTMLElement;\n        if (opts.responsive && opts.width && opts.height) {\n            let min = Math.min(width / opts.width, height / opts.height);\n            width = Math.floor(opts.width * min);\n            height = Math.floor(opts.height * min);\n        } else if (opts.width && opts.height) {\n            width = opts.width;\n            height = opts.height;\n        }\n        let distance = (axis == \"Y\" ? width : height) / 2, rotate = dir => {\n            if (document.hasFocus()) {\n                dir = dir || (opts.dir % 2 == 1 ? 1 : -1);\n                rDeg += 90 * dir;\n                cube.style.transform = `translateZ(-${distance}px) rotate${axis}(${rDeg}deg)`;\n            }\n        }, getLocale = (...args) => {\n            let str = \"\";\n            if (args.length > 0 && args[0] in locale) {\n                str = locale[args[0]];\n                for (let i = 1; i < args.length; i++) {\n                    str = str.replace(\"%s\", args[i]);\n                }\n            }\n            return str;\n        };\n        backdrop.className = `ads-cube-backdrop ${opts.popup ? \"popup\" : \"\"}`;\n        container.className = \"ads-cube-container\";\n        container.style.width = width;\n        container.style.height = height;\n        cube.className = \"ads-cube\";\n        cube.style.transform = `translateZ(-${distance}px)`;\n        if (opts.autoRotate) {\n            setInterval(rotate, typeof opts.autoRotate === \"number\" ? opts.autoRotate : 1e4);\n        }\n        if (axis == \"Y\") {\n            cube.rotateLeft = () => rotate(-1);\n            cube.rotateRight = () => rotate(1);\n        } else {\n            cube.rotateUp = () => rotate(1);\n            cube.rotateDown = () => rotate(-1);\n        }\n        while (opts.ads.length < 4) {\n            opts.ads = opts.ads.concat(opts.ads).slice(0, 4);\n        }\n        opts.ads = opts.ads.slice(0, 4);\n        opts.ads.map((ad, i) => {\n            let side = document.createElement(\"div\");\n            side.className = \"ads-cube-side\";\n            if (isDomElem(ad.src)) {\n                side.appendChild(ad.src);\n            } else {\n                side.style.backgroundImage = `url(\"${ad.src}\")`;\n            }\n            side.style.transform = `translate${i % 2 == 0 ? \"Z\" : axis == \"Y\" ? \"X\" : \"Y\"}(${distance * (i > 1 ? -1 : 1)}px)${i == 0 ? \"\" : ` rotate${axis}(${i % 2 == 1 ? 90 : -180}deg)`}${axis == \"Y\" && i == 3 || axis == \"X\" && i == 1 ? ` scale${axis == \"Y\" ? \"X\" : \"Y\"}(-1)` : \"\"}`;\n            if (ad.link) side.onclick = () => window.open(ad.link);\n            cube.appendChild(side);\n        });\n        container.appendChild(cube);\n        backdrop.appendChild(container);\n        if (opts.popup) {\n            let link = document.createElement(\"a\"), counter = document.createElement(\"div\"), timeout = opts.popupWait || 0, interval = 10, countdown = time => {\n                setTimeout(() => {\n                    let rounded = Math.round(time);\n                    if (opts.counter) {\n                        let ratio = 1 - time / timeout, pts = [ \"50% 50%\", \"200% 50%\" ];\n                        if (opts.counter == 3) {\n                            counter.querySelector(\".bar\").style.width = document.body.clientWidth * ratio;\n                        } else {\n                            if (ratio < 7 / 8) pts.push(\"100% 0\");\n                            if (ratio < 5 / 8) pts.push(\"0 0\");\n                            if (ratio < 3 / 8) pts.push(\"0 100%\");\n                            if (ratio < 1 / 8) pts.push(\"100% 100%\");\n                            let x = Math.cos(ratio * 2 * Math.PI) * 150 + 50, y = Math.sin(ratio * 2 * Math.PI) * 150 + 50;\n                            pts.push(`${x}% ${y}%`);\n                            counter.querySelector(\".ring\").style.clipPath = `polygon(${pts.join(\",\")})`;\n                            if (opts.counter == 2) {\n                                counter.querySelector(\".display\").innerHTML = rounded;\n                            }\n                        }\n                    } else {\n                        link.innerHTML = getLocale(\"waitingMessage\", rounded);\n                    }\n                    if (time >= 0) {\n                        countdown(time - interval / 1e3);\n                    } else {\n                        link.innerHTML = getLocale(\"closeMessage\");\n                        counter.remove();\n                        cube.canClose = true;\n                        link.onclick = () => cube.closePopup();\n                        if (opts.autoClose) link.click();\n                    }\n                }, interval);\n            };\n            cube.closePopup = () => {\n                if (cube.canClose) backdrop.remove();\n            };\n            link.className = \"close\";\n            link.href = \"javascript:void(0)\";\n            if (opts.counter) {\n                let elem = document.createElement(\"div\");\n                if (opts.counter == 3) {\n                    elem.className = \"bar\";\n                } else {\n                    elem.className = \"ring\";\n                    if (opts.counter == 2) {\n                        let display = document.createElement(\"div\");\n                        display.className = \"display\";\n                        counter.appendChild(display);\n                    }\n                }\n                counter.className = \"ads-countdown\";\n                counter.appendChild(elem);\n                backdrop.appendChild(counter);\n            }\n            countdown(timeout);\n            cube.canClose = false;\n            backdrop.appendChild(link);\n            document.body.appendChild(backdrop);\n        } else if (opts.container) {\n            let elem;\n            if (isDomElem(opts.container)) elem = opts.container; else if (typeof opts.container === \"string\") elem = document.querySelector(opts.container);\n            if (elem) elem.appendChild(backdrop);\n        }\n        return cube;\n    };\n}));"]}